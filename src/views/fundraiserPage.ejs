<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- font Awsom link -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Links -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <!-- Linking google font Icons -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=arrow_forward"
    />

    <!-- linking SwiperJS CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link rel="stylesheet" href="/css/fundraiserPage.css" />
    <link rel="icon" type="image/icon type" href="/images/logo.jpg" />

    <title id="tabTitle"></title>
  </head>
  <body>
    <!-- Navbar html -->
    <nav
      class="navbar navbar-expand-lg"
      style="background-color: rgb(243, 194, 103); padding: 20px"
    >
      <div class="container">
        <a
          class="navbar-brand fs-4"
          href="/"
          style="color: #703734; font-weight: 600"
        >
          <img
            src="/images/logo.jpg"
            class="navbar-logo"
            alt="Logo"
            style="
              width: 50px;
              height: auto;
              margin-right: 7px;
              object-fit: contain;
            "
          />OpenHands</a
        >

        <!-- Toogle Button -->

        <button
          class="navbar-toggler shadow-none border-0"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar"
          aria-controls="offcanvasNavbar"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- SideBar -->
        <div
          class="sidebar offcanvas offcanvas-start"
          tabindex="-1"
          id="offcanvasNavbar"
          aria-labelledby="offcanvasNavbarLabel"
          style="background-color: white"
        >
          <!-- SideBar Header -->
          <div class="offcanvas-header border-bottom-color-brown">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">OpenHands</h5>
            <button
              type="button"
              class="btn-close btn-close-black shadow-none"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
            ></button>
          </div>

          <!-- SideBar Body -->

          <div class="offcanvas-body d-flex flex-column flex-lg-row p-4 p-lg-0">
            <ul
              class="navbar-nav justify-content-center align-items-center fs-5 flex-grow-1 ps-3"
            >
              <li class="nav-item mx-2">
                <a class="nav-link" href="#">Home</a>
              </li>
              <li class="nav-item mx-2">
                <a class="nav-link" href="/aboutUs">About</a>
              </li>
              <li class="nav-item mx-2">
                <a class="nav-link" href="/contactUs">Contact</a>
              </li>
            </ul>
            <!-- Login Signup -->
            <div
              class="d-flex justify-content-center flex-column flex-lg-row align-items-center gap-3"
            >
              <a id="signin-btn" href="/login" class="sign-in px-3 fs-5 hidden"
                >Sign in</a
              >
              <a id="view-profile-btn" class="sign-in px-3 fs-5 hidden"
                >View Profile</a
              >
              <a
                href="/adminDashboard"
                id="view-admin-dashboard-btn"
                class="sign-in px-3 fs-5 hidden"
                >View Admin Dashboard</a
              >
              <a
                href="/createfundraiser"
                class="text-white text-decoration-none px-4 py-1 btn btn rounded-4"
                >Create a Fundraiser</a
              >
              <a href="" id="logout" class="log-out px-3 fs-5 hidden">
                <i class="fa-solid fa-power-off" style="color: #703734"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <br /><br />
    <!-- Main Start -->
    <div class="container">
      <div class="text-container heading">
        <h1 id="title" class="display-6" style="color: #703734"></h1>
      </div>
    </div>

    <!-- Image -->
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <div id="image" class="image"></div>
        </div>
        <div class="col-md-4">
          <div class="goal-container">
            <div class="goal-header">
              <span class="goal-title">Goal:</span>
              <span id="goal-amount" class="goal-amount"></span>
            </div>
            <div class="goal-divider"></div>
            <div class="goal-buttons">
              <button id="donate-btn" class="goal-button donate-button">
                <i
                  class="fas fa-donate"
                  data-bs-toggle="modal"
                  data-bs-target="#donateModal"
                ></i
                >Donate Now
              </button>
            </div>
            <div class="icons">
              <a href="#"
                ><img class="logo" src="/images/logo.jpg" alt="Logo"
              /></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br />
    <!-- content -->
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <div class="organizer">
            <i class="fa-solid fa-user"></i>
            <h6 id="name" class="fs-6"></h6>
          </div>
        </div>
      </div>
    </div>

    <!-- verified button -->
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <div class="shield">
            <button id="open-modal-btn" class="shieldbutton" href="#">
              <i class="fa-solid fa-shield"></i>Verified
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- description -->
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <p id="text-content" class="text-content"></p>
          <a id="show-more-btn" class="show-more-btn">Show More</a>

          <hr />
        </div>
      </div>
    </div>
    <br />

    <!-- browse all features -->

    <div
      class="container-fluid flex"
      style="background-color: bisque; padding: 120px 20px; border-radius: 20px"
    >
      <div class="container txt text-left">
        <div class="row">
          <div class="col-md-8">
            <h1 class="fs-2 fw-bold" style="color: #703734">
              More ways to make a difference. Find fundraisers inspired by what
              you care about.
            </h1>
          </div>
        </div>

        <div class="container swiper">
          <div class="card-wrapper">
            <div id="featured-slider" class="card-list swiper-wrapper"></div>

            <div class="swiper-pagination"></div>
            <div class="swiper-slide-button swiper-button-prev"></div>
            <div class="swiper-slide-button swiper-button-next"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Donation Protection HTML -->
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <div id="modal" class="modal">
            <div class="modal-content">
              <span id="close-modal-btn" class="close-modal-btn">&times;</span>
              <h6 class="fs-3 text-center" style="font-weight: 600">
                OpenHands
              </h6>
              <h6
                class="fs-3 text-center"
                style="margin-top: -5px; font-weight: 600"
              >
                Giving Guarantee
              </h6>
              <p class="text text-center" style="margin-top: 20px">
                This fundraiser has been approved by the OpenHands team.
              </p>
              <a
                class="text text-center"
                href="/aboutUs"
                style="
                  margin-top: -15px;
                  text-decoration: underline;
                  color: gray;
                "
                >Learn More</a
              >
              <hr />
              <p
                class="text text-center"
                style="margin-top: 10px; font-size: 14px"
              >
                <i class="fa-regular fa-clock"></i>Donations of any amount are
                covered for one full year after you donate.
              </p>
              <p
                class="text text-center"
                style="margin-top: -5px; font-size: 14px"
              >
                <i class="fa-solid fa-earth-americas"></i>Worldwide coverage,
                wherever you donate from.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
<!-- Donation Form Modal -->
    <div class="donation-modal hidden">
      <div class="donation-modal-content">
        <button class="donation-modal-close">&times;</button>
        <h2 class="donation-modal-title">Make a Donation</h2>
        <form class="donation-form">
          <div class="donation-form-group">
            <label for="donor-name" class="donation-form-label">Your Name</label>
            <input type="text" id="donor-name" name="donorName" class="donation-form-input" placeholder="Enter your name" required />
          </div>

          <div class="donation-form-group">
            <label for="donation-amount" class="donation-form-label">Donation Amount</label>
            <input type="number" id="donation-amount" name="amount" class="donation-form-input" placeholder="Enter amount in PKR" required min="1" />
          </div>

          <div class="donation-form-group">
            <label for="message" class="donation-form-label">Message (Optional)</label>
            <textarea id="message" name="message" class="donation-form-textarea" placeholder="Leave a message"></textarea>
          </div>

          <div class="donation-form-group">
            <label for="phone" class="donation-form-label">Phone Number (for SMS)</label>
            <input type="text" id="phone" name="phone" class="donation-form-input" placeholder="+923XXXXXXXXX" required />
          </div>

          <button type="submit" class="donation-form-submit">Donate</button>
        </form>
      </div>
    </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    <% if (user && !isAdmin) { %>
      document.getElementById("view-profile-btn").classList.remove("hidden");
      document.getElementById("logout").classList.remove("hidden");
    <% } else if (user && isAdmin) { %>
      document.getElementById("view-admin-dashboard-btn").classList.remove("hidden");
      document.getElementById("logout").classList.remove("hidden");
    <% } else { %>
      document.getElementById("signin-btn").classList.remove("hidden");
    <% } %>
  });

  document.querySelector(".donation-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const donorName = document.getElementById("donor-name").value.trim();
    const amount = document.getElementById("donation-amount").value.trim();
    const message = document.getElementById("message").value.trim();
    const phone = document.getElementById("phone").value.trim();

    // ✅ Input validations
    const phoneRegex = /^\+923\d{9}$/;
    if (!phoneRegex.test(phone)) {
      return alert("Phone number must be in +923XXXXXXXXX format.");
    }

    if (!amount || isNaN(amount) || parseInt(amount) <= 0) {
      return alert("Donation amount must be a positive number.");
    }

    if (!donorName) {
      return alert("Please enter your name.");
    }

    try {
      const res = await fetch("/api/payment/donate", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ donorName, amount, message, phone }),
      });

      const data = await res.json();
      if (data.url) {
        window.location.href = data.url;
      } else if (data.error) {
        alert(data.error);
      } else {
        alert("Something went wrong.");
      }
    } catch (err) {
      console.error("Donation error:", err);
      alert("An error occurred while processing your donation.");
    }
  });
</script>

  

    <!-- Linking SwiperJS Script -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Linking Script -->
    <script src="/js/fundraiserPage.js"></script>
    <script src="/js/global.js"></script>
  </body>
</html>
